name: ROS2 CI

on:
  push:
  workflow_dispatch:

jobs:
  image_check:
      runs-on: ubuntu-latest
      steps:
      - name: Check if image exists
        id: image-checking
        run: |
          if docker pull ghcr.io/${{ github.repository_owner }}/ros2_humble:latest; then
            echo "Image already exists"
            echo "::set-output name=image-exists::true"
          
  ros2_build:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/${{ github.repository_owner }}/ros2_humble
      
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up ROS2 workspace
      id: build_test
      run: |
        cd /root/ros2_ws/
        source /opt/ros/humble/setup.sh && colcon build
    - name: build_test command success
      if: steps.build_test.outcome == 'success'
      run: echo "result - success"
    - name: build_test command failure
      if: steps.build_test.outcome == 'failure'
      run: echo "result - failure" && exit 1
